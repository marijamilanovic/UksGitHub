{% extends 'repository/index.html' %}
{% load static %}
{% load bootstrap_icons %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'home/style.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>

<body>
    {% block navCode %}
      <li class="nav-item">
        <a class="nav-link active" href="{% url 'repository' id=repository.id %}" style= "color: black;" id="code" aria-current="page">{% bs_icon 'code' size='1em' %} Code</a>
      </li>
    {% endblock %}

    {% block navIssues %}
      <li class="nav-item">
        <a class="nav-link"  id="issues" style="border-bottom:3px solid darkviolet;color: black;" href="{% url 'issues' id=repository.id  %}">{% bs_icon 'record-circle' size='1em' %} Issues</a>
      </li>
    {% endblock %}

    {% block page_content %}
    <div class="tab-pane container active" id="issues">
    <h2 style="margin-top: -20px;">Issue</h2>
        <form style="margin-top: 20px; margin-left: -12px;" method="POST" action="{% url 'update_issue' id=issue.id %}"> 
            {% csrf_token %}
            <div style="margin-left: 600px;position: absolute;">
                Assignees:
                <br>
                <select name="developers" style="min-width:100px;border-radius: 6px;border: 2px solid #AAA;box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.1);" class="selectpicker" multiple data-live-search="true">
                    {% for dev in developers.all %}
                        {% if dev in  issue.assignees.all %} 
                            <option value="{{ dev.username }}" selected>{{ dev.username }}</option>
                        {% else %}      
                            <option value="{{ dev.username }}">{{ dev.username }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
                <hr color='gray' style=" box-shadow: 0 0 2px 0.5px gray;">
                Labels:
                <br>
                <select name="cars" id="cars">
                    <option value="masha"> todo</option>
                </select>
                <hr color='gray' style=" box-shadow: 0 0 2px 0.5px gray;">
                Projects:
                <br>
                <select name="projects_ids" style="min-width:100px;border-radius: 6px;border: 2px solid #AAA;box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.1);" class="selectpicker" multiple data-live-search="true">
                    {% for p in projects.all %}
                        {% if p in  issue.projects.all %} 
                            <option value="{{ p.id }}" selected>{{ p.name }}</option>
                        {% else %}      
                            <option value="{{ p.id }}">{{ p.name }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
                <hr color='gray' style=" box-shadow: 0 0 2px 0.5px gray;">
                Milestone:
                <br>
                <select name="milestone_id"  style="min-width:100px;border-radius: 6px;border: 2px solid #AAA;box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.1);" class="selectpicker" data-live-search="true">
                    <option value="empty"></option>
                    {% for m in milestones %}
                        {% if m.id == issue.milestone.id %}
                            <option value="{{ m.id }}" selected>{{ m.title }} (Due by: {{m.due_date}})</option>
                        {% else %}
                            <option value="{{ m.id }}">{{ m.title }} (Due by: {{m.due_date}})</option>
                        {% endif %}
                    {% endfor %}
                </select>
                <hr color='gray' style=" box-shadow: 0 0 2px 0.5px gray;">
                Linked pull request:
                <br>
                <select name="pullrequests_ids" style="min-width:100px;border-radius: 6px;border: 2px solid #AAA;box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.1);" class="selectpicker" multiple data-live-search="true">
                    {% for pr in pullrequests.all %}
                        {% if pr in  issue.pullrequests.all %} 
                            <option value="{{ pr.id }}" selected>{{ pr.name }}</option>
                        {% else %}      
                            <option value="{{ pr.id }}">{{ pr.name }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
                <br><br><br>   
            </div>
            <br>
            <div class="form-group col-md-6">
                <h5>Title</h5> 
                <input type="text" class="form-control" id="title" name="title" value="{{ issue.issue_title }}">
            </div>
            
            {% if errorTitle %}
            <div style="color: red; margin-left: 14px;" >{{errorTitle}}</div>
            {% endif %}
            <div class="form-group col-md-6">
                <h5 for="description">Description</h5>
                <textarea class="form-control col-md-12" id="description" rows="4" name="description">{{issue.description}}</textarea>
            </div>
            <div class="form-check form-check-inline">
                {% if issue.state == 'Opened' %}
                    <input class="form-check-input" type="radio" name="state" id="inlineRadio1" value="Opened" checked>
                {% else %}
                    <input class="form-check-input" type="radio" name="state" id="inlineRadio1" value="Opened">
                {% endif %}
                <label class="form-check-label" for="inlineRadio1" checked>Open</label>
            </div>
            <div class="form-check form-check-inline">
                {% if issue.state == 'Close' %}
                    <input class="form-check-input" type="radio" name="state" id="inlineRadio2" value="Close" checked>
                {% else %}
                    <input class="form-check-input" type="radio" name="state" id="inlineRadio2" value="Close">
                {% endif %}
                <label class="form-check-label" for="inlineRadio2">Closed</label>
            </div>
            <br><br>
            <input type="submit" style="margin-left: 12px; margin-top: 5px;"  class="btn btn-success" value="Update">
        </form>
    </div>  
    {% endblock %}

    {% block javascript %}
    <script>
    </script>
    {% endblock %}
</body>
</html>